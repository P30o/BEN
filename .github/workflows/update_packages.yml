name: ğŸš€ ØªØ­Ø¯ÙŠØ« Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø­Ø²Ù… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ

on:
  push:
    paths:
      - 'debs/**'
  workflow_dispatch:

jobs:
  update_packages:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª

    steps:
      - name: â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}  # âš ï¸ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ù…Ø¯Ù…Ø¬

      - name: âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ¦Ø©
        run: |
          sudo apt-get update
          sudo apt-get install -y dpkg-dev bzip2 xz-utils gzip

      - name: ğŸ“¦ Ø¥Ù†Ø´Ø§Ø¡ Packages
        run: |
          dpkg-scanpackages -m debs /dev/null > Packages
          bzip2 -kf Packages
          xz -kf Packages
          gzip -kf Packages
          md5sum Packages > Packages.md5
          sha1sum Packages > Packages.sha1
          sha256sum Packages > Packages.sha256

      - name: ğŸ”„ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          
          git add Packages*
          
          # ØªØ¬Ù†Ø¨ Ø§Ù„Ø®Ø·Ø£ 128 Ø¨Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ§Ø±ÙŠØ®
          git pull --rebase  # âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·ÙˆØ© Ø¬Ø¯ÙŠØ¯Ø©
          
          if [ -n "$(git status --porcelain)" ]; then
            git commit -m "ğŸ”„ ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ [skip ci]"
            git push origin HEAD:${GITHUB_REF#refs/heads/}  # âš ï¸ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ØµÙŠØºØ© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„Ù„Ø¯ÙØ¹
          fi