name: ğŸš€ ØªØ­Ø¯ÙŠØ« Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø­Ø²Ù… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ

on:
  push:
    paths:
      - 'debs/**'  # ÙŠØªÙØ¹Ù„ ÙÙ‚Ø· Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ù…Ù„ÙØ§Øª ÙÙŠ Ù…Ø¬Ù„Ø¯ debs
  pull_request:
    paths:
      - 'debs/**'
  workflow_dispatch:  # ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ

jobs:
  update_packages:
    runs-on: ubuntu-latest
    steps:
      # Ø§Ù„Ø®Ø·ÙˆØ© 1: ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
      - name: â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Ø¶Ø±ÙˆØ±ÙŠ Ù„Ø¹Ù…Ù„ÙŠØ§Øª git Ø§Ù„Ù„Ø§Ø­Ù‚Ø©

      # Ø§Ù„Ø®Ø·ÙˆØ© 2: ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª
      - name: âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ¦Ø©
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            dpkg-dev \
            bzip2 \
            xz-utils \
            gzip

      # Ø§Ù„Ø®Ø·ÙˆØ© 3: Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„ÙØ§Øª Ø§Ù„ÙÙ‡Ø±Ø³
      - name: ğŸ“¦ Ø¥Ù†Ø´Ø§Ø¡ Packages
        run: |
          # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
          dpkg-scanpackages -m debs /dev/null > Packages
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù…Ø¶ØºÙˆØ·Ø©
          bzip2 -kf Packages
          xz -kf Packages
          gzip -kf Packages
          
          # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„ÙØ§Øª Ø§Ù„ØªØ¬Ø²Ø¦Ø©
          md5sum Packages > Packages.md5
          sha1sum Packages > Packages.sha1
          sha256sum Packages > Packages.sha256

      # Ø§Ù„Ø®Ø·ÙˆØ© 4: Ø±ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
      - name: ğŸ”„ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          
          git add Packages*
          
          if [ -n "$(git status --porcelain)" ]; then
            git commit -m "ğŸ”„ ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ø­Ø²Ù… [skip ci]"
            git push
          else
            echo "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª Ù„Ø±ÙØ¹Ù‡Ø§"
          fi